#!/bin/bash

#set -x

# Insert a USER_OVERRIDE record
#
# psql -U postgres 
#      -d scanner 
#      -c "select * from alerts where message_arguments = 'USER_OVERRIDE'"
#  id | node_id | target_name | target_type | target_extra | field | value 
#
#     | units | status | message_tag | message_arguments | timestamp 
#

STATUS='DEAD'
TAG='NODE_SERVER_STATUS'

# ----------------------------------------------------------------------
function usage() {

if [ -n $1 ]; then
    echo "
You passed an unfamiliar argument, '$1'
"
fi

echo "
USAGE: $0 [-s status ] [ -t tag] [-v]

Where
        status : one of 'OK',   'DEBUG',   'WARNING', 'CRISIS',
                        'DEAD' ( the default), 'ENABLED', 'DISABLED'
        tag    : one of 'NODE_SERVER_STATUS (the default)
                     or 'USER_OVERRIDE'
        v      : display the resulting SQL query instead of running it
"
exit 1
}

# ----------------------------------------------------------------------
# MAIN processing
#
while getopts ":s:t:v" opt; do
    case $opt in
      s) STATUS=$OPTARG
         ;;
      t) TAG=$OPTARG
         ;;
      v) VERBOSE=1
         ;;
      *) usage $opt
         ;;
    esac
done


SQL="
    INSERT INTO alerts
    ( target_name, target_type, field, value, status,
       message_tag, message_arguments )
    VALUES
    ( 'scanner', 'an-a07n01', 'node server', 'an-a07n01', '$STATUS',
      '$TAG', 'an-a07n01') 
"

if [ $VERBOSE ]; then
    echo "$SQL"
else 
    psql -U postgres -d scanner -c "$SQL"
fi

# ----------------------------------------------------------------------
# End of File.
